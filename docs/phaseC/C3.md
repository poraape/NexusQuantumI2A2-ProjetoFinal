# C3 — Cache Multi-Camada

## Objetivo
Projetar e ativar política de cache hierárquico cobrindo edge, memória curta (Redis) e vetor (Qdrant), garantindo hit ratio ≥85%.

## Entradas
- Política inicial `cache/policy.md`
- Métricas de baseline `benchmarks/cache-before.json`
- Configurações de Redis/Qdrant

## Passos
1. Definir tabelas de roteamento de cache por tipo de payload (chat, relatórios, forecasts).
2. Implementar middlewares no BFF utilizando `adapters/eventBusAdapter.ts` para incluir headers `cache-intent`.
3. Configurar edge cache (Cloudflare/Netlify) conforme seção `Edge` do `cache/policy.md`.
4. Instrumentar métricas `cache_hit_total` e `cache_miss_total` no `metrics/base.prom`.
5. Executar `tests/perf/cache-benchmark.mjs` e consolidar resultados em `benchmarks/cache.json`.

## Saídas
- `cache/policy.md` atualizado com TTLs, tamanhos e regras de invalidação.
- `benchmarks/cache.json` com comparativo antes/depois.
- Atualização do painel `dashboards/cost-usage.json` com hit ratio.

## Critérios de Aceitação
- Hit ratio agregado ≥85%.
- Nenhuma violação de consistência (auditoria `audits/cache-integrity.md`).
- Documentação de fallback manual.
